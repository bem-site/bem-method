# Сборка БЭМ-проекта

* [Введение](#Введение)
* [Задачи сборки](#Задачи-сборки)
* [Этапы сборки](#Этапы-сборки)
* [Результат сборки](#Результат-сборки)
* [Инструменты для сборки](#Инструменты-для-сборки)

## Введение

В БЭМ-проекте код разделяется на мелкие [независимые части](../filestructure/filestructure.ru.md#Принципы-организации-файловой-структуры-БЭМ-проекта) (исходные файлы). Перед отправкой в браузер файлы собираются и оптимизируются.

Чтобы объединить исходные файлы в один (`project.css`, `project.js`, `project.bemhtml.js` и т. п.), используется сборка. Файлы, полученные в результате сборки, в БЭМ-методологии принято называть **бандлами**.

**Пример**

![Сборка БЭМ-проекта](https://rawgit.com/bem-site/bem-method/godfreyd-methodology-deps/method/build/build__bem-project.svg)

## Задачи сборки

Сборка решает следующие задачи:

* Объединяет исходные файлы, разложенные по файловой структуре проекта.
* Подключает в проект только нужные [БЭМ-сущности](../key-concepts/key-concepts.ru.md#БЭМ-сущность).
* Учитывает порядок подключения файлов в проект.
* Преобразует исходные файлы (например, `.styl` в `.css`).

## Этапы сборки

Общий порядок сборки и роль [используемого инструмента](#Инструменты-для-сборки) могут отличаться для разных проектов. Поэтому этапы сборки в данном разделе рассматриваются как частный случай применения сборки.

Чтобы в результате сборки получить, например, веб-страницу необходимо:

1. [Определить список БЭМ-сущностей для страницы](#Определение-списка-БЭМ-сущностей).
2. [Описать зависимости между ними](#Описание-зависимостей).
3. [Определить порядок их подключения](#Определение-порядка-подключения-БЭМ-сущностей-в-сборку).

### Определение списка БЭМ-сущностей

Чтобы включить в сборку только необходимые БЭМ-сущности, нужно составить список блоков, элементов и модификаторов, используемых на странице. Такой список называется [декларацией](../declarations/declarations.ru.md).

Инструмент сборки, основываясь на данных из декларации, добавляет в бандлы только перечисленные БЭМ-сущности.

**Пример**

![Сборка БЭМ-проекта](https://rawgit.com/bem-site/bem-method/godfreyd-methodology-deps/method/build/build__declaration.svg)

В данном примере на основе списка (Declaration) БЭМ-сущностей в бандлы (`project.css`, `project.js`) попадают перечисленные блоки (`button`, `logo`, `input`).

> Сведения о том, как построить декларацию см. в разделе [Способы получения декларации](../declarations/declarations.ru.md#Способы-получения-декларации).

### Описание зависимостей

В БЭМ-методологии блоки могут строиться на основании других блоков. Для этого необходимо указать зависимости от них. Описать зависимости можно любым удобным способом (например, комментариями в коде).

Инструмент сборки получает данные о зависимостях и добавляет все БЭМ-сущности, необходимые для реализации блока. Ниже приведен пример составного блока.

**Пример**

![Пример составного блока](https://rawgit.com/bem-site/bem-method/godfreyd-methodology-deps/method/build/build__search-form.svg)

В данном примере форма поиска `search-form` построена на основе блоков `input` (поле ввода) и `button` (кнопка). Не обязательно реализовывать кнопку и поле ввода повторно. Достаточно указать зависимости от них.

> Сведения о том, как описать зависимости от иных БЭМ-сущностей и технологий см. в разделе [Технология для описания зависимостей](https://ru.bem.info/technology/deps/).

### Определение порядка подключения БЭМ-сущностей в сборку

Порядок подключения БЭМ-сущностей в сборку зависит от:

* [Указанных зависимостей](#Зависимости-и-порядок-подключения-БЭМ-сущностей-в-сборку).
* [Используемых уровней переопределения](#Уровни-переопределения-и-порядок-подключения-БЭМ-сущностей-в-сборку).

#### Зависимости и порядок подключения БЭМ-сущностей в сборку

В БЭМ зависимости могут влиять на порядок подключения БЭМ-сущностей в сборку.

> Сведения о том, как определить порядок подключения БЭМ-сущностей в сборку см. в разделе [Синтаксис DEPS](https://ru.bem.info/platform/deps/#Поля-определяющие-зависимость).

#### Уровни переопределения и порядок подключения БЭМ-сущностей в сборку

В БЭМ конечная реализация блока может быть разделена по разным [уровням переопределения](../key-concepts/key-concepts.ru.md#Уровень-переопределения). Каждый последующий уровень добавляет или перекрывает исходную реализацию блока.

**Пример**

![Уровни переопределения](https://rawgit.com/bem-site/bem-method/godfreyd-methodology-deps/method/build/build__levels.svg)

В данном примере с уровня `common.blocks` подключаются общие (для всех платформ) CSS- и JS-реализации для блока `button`, а с уровней `desktop.blocks` и `touch.blocks` — CSS- и JS-реализации, специфичные для каждой из платформ.

Таким образом, уровни переопределения позволяют изменять представление и поведение блоков для различных платформ.

Поэтому важно, чтобы сначала в сборку попадала исходная реализация, а затем изменения со всех уровней переопределения.

Подробно об использовании уровней переопределения читайте в примерах:

* [Переопределение блоков библиотеки](../filestructure/filestructure.ru.md#Подключение-библиотеки).
* [Разделение проекта на платформы](../filestructure/filestructure.ru.md#Разделение-проекта-на-платформы).

## Результат сборки

В результате сборки можно получить разные финальные наборы файлов:

* файлы для фрагмента страницы (например, `header.css` или `footer.css`);
* файлы для отдельной страницы (например, `hello.css` и `hello.js`);
* файлы для всего проекта (например, `project.css` и `project.js`).

В качестве примера рассмотрим сборку страницы `hello`.

**Пример**

Файловая структура БЭМ-проекта до выполнения сборки:

```files
blocks/                 # Директория, содержащая блоки

bundles/                # Директория, содержащая результаты сборки (опционально)
    hello/              # Директория страницы `hello` (создается вручную)
        hello.decl.js   # Список БЭМ-сущностей, необходимых для страницы `hello`
```

Файловая структура БЭМ-проекта после выполнения сборки:

```files
blocks/                 

bundles/                
    hello/              
        hello.decl.js   
        hello.css       # Собранный CSS-файл страницы `hello`
        hello.js        # Собранный JavaScript-файл страницы `hello`
```

При сборке в проект могут быть включены:

* все БЭМ-сущности с файловой структуры проекта (что значительно увеличивает объем результирующего кода);
* только необходимые для построения страницы БЭМ-сущности в строго определенном порядке.

## Инструменты для сборки

БЭМ-методология не ограничивает выбор инструмента. Можно использовать любые сборщики отвечающие требованиям проекта.

В БЭМ-платформе используются сборщики [ENB](https://ru.bem.info/tools/bem/enb-bem/) и [Gulp](http://gulpjs.com/), которые подходят для сборки БЭМ-проектов любой сложности.

> Пример сборки БЭМ-проекта с помощью [ENB](https://ru.bem.info/tools/bem/enb-bem/) — [Создаем проект по БЭМ](https://ru.bem.info/tutorials/start-with-project-stub/).

> Пример сборки БЭМ-проекта с помощью [Gulp](http://gulpjs.com/) — [Декларативный JavaScript по БЭМ](https://ru.bem.info/forum/-696/).
