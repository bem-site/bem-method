# Сборка БЭМ-проекта

* [Введение](#Введение)
* [Задачи сборки](#Задачи-сборки)
* [Этапы сборки](#Этапы-сборки)
* [Результат сборки](#Результат-сборки)
* [Инструменты для сборки](#Инструменты-для-сборки)

## Введение

В БЭМ-проекте код разделяется на [отдельные файлы](../filestructure/filestructure.ru.md#Принципы-организации-файловой-структуры-БЭМ-проекта) (также называемые исходными файлами).

Чтобы объединить исходные файлы в один (например, все CSS-файлы в `project.css`, все JS-файлы в `project.js` и т. п.), используется сборка. Такие файлы, полученные в результате сборки, в БЭМ-методологии принято называть **бандлами**.

**Пример**

![Сборка БЭМ-проекта](https://cdn.rawgit.com/bem-site/bem-method/bem-info-data/method/build/build__bem-project.svg)

## Задачи сборки

Сборка решает следующие задачи:

* Объединяет исходные файлы, разложенные по файловой структуре проекта.
* Подключает в проект только необходимые блоки, элементы и модификаторы ([БЭМ-сущности](../key-concepts/key-concepts.ru.md#БЭМ-сущность)).
* Учитывает порядок подключения.
* Обрабатывает код исходных файлов в процессе сборки (например, компилирует LESS-код в CSS-код).

## Этапы сборки

Чтобы в результате сборки получить бандлы необходимо определить:

1. [Список БЭМ-сущностей](#Определение-списка-БЭМ-сущностей).
2. [Зависимости между ними](#Описание-зависимостей).
3. [Порядок их подключения](#Определение-порядка-подключения-БЭМ-сущностей-в-сборку).

### Определение списка БЭМ-сущностей

Чтобы включить в сборку только необходимые БЭМ-сущности, нужно составить список блоков, элементов и модификаторов, используемых на странице. Такой список называется [декларацией](../declarations/declarations.ru.md).

Инструмент сборки, основываясь на данных из декларации, добавляет в бандлы только перечисленные БЭМ-сущности. Ниже приведен пример сборки бандлов на основе списка БЭМ-сущностей (Declaration).

**Пример**

![Сборка БЭМ-проекта](https://cdn.rawgit.com/bem-site/bem-method/bem-info-data/method/build/build__declaration.svg)

Декларация позволяет изменять состав получаемых при сборке бандлов. Это избавляет от ненужного кода, который значительно увеличивает объем бандлов.

> Подробнее о том, как построить декларацию, см. в разделе [Способы получения декларации](../declarations/declarations.ru.md#Способы-получения-декларации).

### Описание зависимостей

В БЭМ блоки могут строиться на основании других блоков. Для этого необходимо указать зависимости от них.

Инструмент сборки получает данные о зависимостях и добавляет все БЭМ-сущности, необходимые для реализации блока. Ниже приведен пример составного блока.

**Пример**

![Пример составного блока](https://cdn.rawgit.com/bem-site/bem-method/bem-info-data/method/build/build__search-form.svg)

Зависимости позволяют строить новые блоки на основе уже существующих. Это избавляет от ненужного «Copy-Paste».

> Подробнее о том, как описать зависимости от иных БЭМ-сущностей и технологий, см. в разделе [Технология для описания зависимостей](https://ru.bem.info/technology/deps/).

### Определение порядка подключения БЭМ-сущностей в сборку

Порядок подключения БЭМ-сущностей в сборку зависит от:

* [Указанных зависимостей](#Зависимости-и-порядок-подключения-БЭМ-сущностей-в-сборку).
* [Используемых уровней переопределения](#Уровни-переопределения-и-порядок-подключения-БЭМ-сущностей-в-сборку).

#### Зависимости и порядок подключения БЭМ-сущностей в сборку

В БЭМ зависимости могут влиять на порядок подключения БЭМ-сущностей в сборку.

> Подробнее о том, как определить порядок подключения БЭМ-сущностей в сборку см. в разделе [Синтаксис DEPS](https://ru.bem.info/platform/deps/#Поля-определяющие-зависимость).

#### Уровни переопределения и порядок подключения БЭМ-сущностей в сборку

В БЭМ конечная реализация блока может быть разделена по разным [уровням переопределения](../key-concepts/key-concepts.ru.md#Уровень-переопределения). Каждый последующий уровень дополняет или перекрывает исходную реализацию блока. Поэтому важно, чтобы сначала в сборку попадала исходная реализация, а затем изменения со всех уровней переопределения. Ниже приведен пример проекта с уровнями переопределения: `common.blocks`, `desktop.blocks`, `touch.blocks`.

**Пример**

![Уровни переопределения](https://cdn.rawgit.com/bem-site/bem-method/bem-info-data/method/build/build__levels.svg)

Уровни переопределения позволяют изменять представление и поведение блоков для различных платформ.

Подробно об использовании уровней переопределения читайте в примерах:

* [Переопределение блоков библиотеки](../filestructure/filestructure.ru.md#Подключение-библиотеки).
* [Разделение проекта на платформы](../filestructure/filestructure.ru.md#Разделение-проекта-на-платформы).

## Результат сборки

В результате сборки можно получить файлы для:

* фрагмента страницы (например, `header.css` или `footer.css`);
* отдельной страницы (например, `hello.css` и `hello.js`);
* всего проекта (например, `project.css` и `project.js`).

Ниже приведен пример сборки страницы `hello`.

**Пример**

Файловая структура БЭМ-проекта до выполнения сборки:

```files
blocks/                 # Директория, содержащая блоки

bundles/                # Директория, содержащая результаты сборки (опционально)
    hello/              # Директория страницы `hello` (создается вручную)
        hello.decl.js   # Список БЭМ-сущностей, необходимых для страницы `hello`
```

Файловая структура БЭМ-проекта после выполнения сборки:

```files
blocks/

bundles/
    hello/
        hello.decl.js
        hello.css       # Собранный CSS-файл страницы `hello` (бандл `hello` в технологии CSS)
        hello.js        # Собранный JS-файл страницы `hello` (бандл `hello` в технологии JS)
```

При сборке в проект могут быть включены:

* все БЭМ-сущности с файловой структуры проекта (значительно увеличивает объем результирующего кода);
* только необходимые для построения страницы БЭМ-сущности.

## Инструменты для сборки

БЭМ-методология не ограничивает выбор инструмента для сборки. Можно использовать любые сборщики отвечающие требованиям проекта.

В БЭМ-платформе используются следующие сборщики:

* [ENB](https://ru.bem.info/tools/bem/enb-bem/);
* [Gulp](http://gulpjs.com/).

> Пример сборки БЭМ-проекта с помощью ENB — [Создаем проект по БЭМ](https://ru.bem.info/tutorials/start-with-project-stub/).
>
> Пример сборки БЭМ-проекта с помощью Gulp — [Декларативный JavaScript по БЭМ](https://ru.bem.info/forum/-696/).
